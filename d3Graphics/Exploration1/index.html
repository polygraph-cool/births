<!doctype html>
<html>
<head>
  <meta charset = "utf-8">
  <title>Birth Trends</title>
  <meta name="description" content="Birth Trends">
  <meta name="author" content="Amber Thomas">

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" type="text/css" href="https://cloud.typography.com/7124072/7681372/css/fonts.css">
  <link rel="stylesheet" href="birthTrends.css">

</head>

<body>

  <div id = "counties"></div>
  <div id = "testing"></div>

  <script src="https://d3js.org/d3.v4.js"></script>
  <!--<script src="birthTrends1.js"></script>-->
  <script>



      //////////////////////////////////////////////////////////////////////
      /////////////////////////  GLOBAL VARIABLES  /////////////////////////
      //////////////////////////////////////////////////////////////////////

      // set the dimensions and margins of the graph
      var margin = {top: 20, right: 20, bottom: 30, left: 50},
        width = 960 - margin.left - margin.right,
        height = 500 - margin.top - margin.bottom;

      // parse the date / time
      var parseTime = d3.timeParse("%m-%Y");

      // set the ranges
      var x = d3.scaleTime().range([0, width]);
      var y = d3.scaleLinear().range([height, 0]);

      /*// Define the axes
      var xAxis = d3.axisBottom()
          .scale(x)

      var yAxis = d3.axisLeft(y)*/

      // define the line
      var valueline = d3.line()
          .x(function(d) { return x(d.monthYear); })
          .y(function(d) { return y(+d.countyBirths); });


      // append the svg object to the body of the page
      // appends a 'group' element to 'svg'
      // moves the 'group' element to the top left margin
      var svg = d3.select("body").append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
        .append("g")
          .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");




      //////////////////////////////////////////////////////////////////////
      ////////////////////////////  DATA IMPORT ////////////////////////////
      //////////////////////////////////////////////////////////////////////


      // Get the data
      d3.csv("test.csv", function(error, data) {
          if (error) throw error;

          // format the data
          data.forEach(function(d) {
              d.monthYear = parseTime(d.monthYear);
              d.countyBirths = +d.countyBirths;
              d.County = d.County;
              d.State = d.State;
          });


          // Nest the data to create a line for each county
          var nested = d3.nest()
              .key(function(d) { return d.County; })
              .entries(data);


          // Create dropdown 1
          var list = d3.select("#counties")
          list.append("select").selectAll("option")
              .data(nested)
              .enter().append("option")
              .attr("value", function(d){
                  return d.key;
              })
              .text(function(d){
                  return d.key;
              })


          // Create line based on selection
          list.on('change', function(){
              var selected = d3.select(this)
                  .select("select")
                  .property("value")

              var selectCounty = nested.filter(function(d){
                return +d.key === +selected;
              });


              // Draw line
              var lines = svg.selectAll("path")
                  .data(selectCounty, function(d){
                    return d ? d.key : this.key;
                  });

              lines.exit().remove();    



              // Scale the range of the data
              x.domain(d3.extent(selectCounty[0].values, function(d) { return d.monthYear; }));
              y.domain([0, d3.max(selectCounty[0].values, function(d) { return +d.countyBirths; })]);

              var linesEnter = lines.enter().append("path")
                  .attr("class", "line")
                  .attr("d", function(d) {
                      return valueline(d.values);
                  });

              lines = lines.merge(linesEnter)


              // Quick fix to destroy axes and re-draw
              svg.selectAll(".axis").remove();  
              

             // Add the X Axis
              var xaxis = svg.append("g")
                  .attr("transform", "translate(0," + height + ")")
                  .attr("class", "axis")
                  //.call(xAxis)
                  .call(d3.axisBottom(x));


              // Add the Y Axis
              var yaxis = svg.append("g")
                  .attr("class", "axis")
                  .call(d3.axisLeft(y)); 





          });

      });

  </script>



</body>
</html>
