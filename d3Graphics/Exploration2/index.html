<!doctype html>
<html>
<head>
  <meta charset = "utf-8">
  <title>Birth Trends</title>
  <meta name="description" content="Birth Trends">
  <meta name="author" content="Amber Thomas">

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="birthTrends.css">

</head>

<body>

<div class="intro-section">
  <p class="intro-prose">Damn (stylized as DAMN.) is the fourth studio album by American rapper Kendrick Lamar.[1] It was released on April 14, 2017, by Top Dawg Entertainment, Aftermath Entertainment and Interscope Records.[2] The album features production from a variety of record producers, including executive producer and Top Dawg Entertainment label-head Anthony "Top Dawg" Tiffith, Sounwave, DJ Dahi, Mike Will Made It and Ricci Riera, as well as production contributions from James Blake, Steve Lacy BadBadNotGood, Greg Kurstin, The Alchemist, 9th Wonder, and others.
  </p>
  <p class="intro-prose">Damn (stylized as DAMN.) is the fourth studio album by American rapper Kendrick Lamar.[1] It was released on April 14, 2017, by Top Dawg Entertainment, Aftermath Entertainment and Interscope Records.[2] The album features production from a variety of record producers, including executive producer and Top Dawg Entertainment label-head Anthony "Top Dawg" Tiffith, Sounwave, DJ Dahi, Mike Will Made It and Ricci Riera, as well as production contributions from James Blake, Steve Lacy BadBadNotGood, Greg Kurstin, The Alchemist, 9th Wonder, and others.
  </p>
  <p class="intro-prose">Damn (stylized as DAMN.) is the fourth studio album by American rapper Kendrick Lamar.[1] It was released on April 14, 2017, by Top Dawg Entertainment, Aftermath Entertainment and Interscope Records.[2] The album features production from a variety of record producers, including executive producer and Top Dawg Entertainment label-head Anthony "Top Dawg" Tiffith, Sounwave, DJ Dahi, Mike Will Made It and Ricci Riera, as well as production contributions from James Blake, Steve Lacy BadBadNotGood, Greg Kurstin, The Alchemist, 9th Wonder, and others.
  </p>
  <p class="intro-prose">Damn (stylized as DAMN.) is the fourth studio album by American rapper Kendrick Lamar.[1] It was released on April 14, 2017, by Top Dawg Entertainment, Aftermath Entertainment and Interscope Records.[2] The album features production from a variety of record producers, including executive producer and Top Dawg Entertainment label-head Anthony "Top Dawg" Tiffith, Sounwave, DJ Dahi, Mike Will Made It and Ricci Riera, as well as production contributions from James Blake, Steve Lacy BadBadNotGood, Greg Kurstin, The Alchemist, 9th Wonder, and others.
  </p>
  <p class="intro-prose">Damn (stylized as DAMN.) is the fourth studio album by American rapper Kendrick Lamar.[1] It was released on April 14, 2017, by Top Dawg Entertainment, Aftermath Entertainment and Interscope Records.[2] The album features production from a variety of record producers, including executive producer and Top Dawg Entertainment label-head Anthony "Top Dawg" Tiffith, Sounwave, DJ Dahi, Mike Will Made It and Ricci Riera, as well as production contributions from James Blake, Steve Lacy BadBadNotGood, Greg Kurstin, The Alchemist, 9th Wonder, and others.
  </p>
  <p class="intro-prose">Damn (stylized as DAMN.) is the fourth studio album by American rapper Kendrick Lamar.[1] It was released on April 14, 2017, by Top Dawg Entertainment, Aftermath Entertainment and Interscope Records.[2] The album features production from a variety of record producers, including executive producer and Top Dawg Entertainment label-head Anthony "Top Dawg" Tiffith, Sounwave, DJ Dahi, Mike Will Made It and Ricci Riera, as well as production contributions from James Blake, Steve Lacy BadBadNotGood, Greg Kurstin, The Alchemist, 9th Wonder, and others.
  </p>
</div>

<div id = "container">

  <div id = "dropdowns">

    <!--Eventual State Dropdown-->
    <div id = "dropdown-a">
      <p class = "dd-title state">State</p>
        <div id = "states", class = "dd">
          <div class="select__arrow long"></div>
        </div>
    </div><!--


   --><div id = "dropdown-b">
      <p class = "dd-title county">County</p>
        <div id = "counties", class = "dd">
          <div class="select__arrow long"></div>
        </div>
    </div><!--


   --><div id = "dropdown-c">
      <p class = "dd-title year">Year</p>
        <div id = "year", class = "dd">
          <div class="select__arrow short"></div>
        </div>
    </div>

  </div>
  <!--Adding event icons-->
  <div id="icons">
    <p class = "dd-title events">Events</p>
    <div id="icon-a">
      <svg width="36" height="36" viewBox="0 0 36 36">
        <g id="icon-storms">
          <path d="M12.5,22C6.8,24.3,4,19.8,4,17c0-2.8,2.3-5.1,5.1-5.1c0.4,0,0.7,0,1,0.1c0-0.1,0-0.2,0-0.3
            c0-4.2,3.4-7.6,7.6-7.6c3.3,0,6.1,2.1,7.2,5C25.3,9.1,25.6,9,26,9c3.3,0,5.9,2.7,5.9,5.9c0,3.3-3.2,8.3-9.3,5.9"/>
          <polygon points="19,15.9 15.2,23.8 19,23.9 17.1,31.9 20.7,22 17.3,22.4"/>
        </g>
      </svg>
    </div>
    <div id="icon-b">
        <svg width="36" height="36" viewBox="0 0 36 36">
          <g id="icon-sports">
              <path d="M29.9,6c2.4,2.4,1.7,12.8-4.7,19.2c-6.3,6.4-16.7,7.3-19.1,4.9c-2.4-2.4-1.8-12.6,4.7-19.2
                C17.3,4.3,27.5,3.6,29.9,6z"/>
              <line x1="5.5" y1="20.4" x2="15.8" y2="30.5"/>
              <line x1="20.3" y1="5.4" x2="30.6" y2="15.5"/>
              <line x1="14.4" y1="21.6" x2="22.2" y2="13.7"/>
              <line x1="14.4" y1="18.7" x2="17.6" y2="21.9"/>
              <line x1="16.9" y1="16.2" x2="20.1" y2="19.4"/>
              <line x1="19.5" y1="13.6" x2="22.7" y2="16.8"/>
          </g>
        </svg>
    </div>
    <div id="icon-c">
        <svg width="36" height="36" viewBox="0 0 36 36">
          <g id="icon-terrorism">
            <polyline points="1.9,31.8 5.9,28.9 0,24.6 7.8,22.9 5.8,12.7 13.2,16.8 19.5,4.2 21.5,18 26.9,14.8 26.9,21.4
              36,22.4 28.6,28.5 30.6,31.8"/>
            <polyline points="10.4,31.8 12.4,29.8 10.4,26.1 12.4,26.1 11.4,21.2 16.1,23.1 18,18 18.7,24.9 22.3,22.9 22.3,26.1
              24.5,26.3 22.6,28.5 25.6,31.8"/>
          </g>
        </svg>
    </div>

    <div id="icon-dropdown"></div>
    <div id="icon-dropdown2"></div>

  </div>
  <div id = "graph"></div>
  <div id="right-column">
    <p class="right-column-prose">Damn (stylized as DAMN.) is the fourth studio album by American rapper Kendrick Lamar.[1] It was released on April 14, 2017, by Top Dawg Entertainment, Aftermath Entertainment and Interscope Records.[2] The album features production from a variety of record producers, including executive producer and Top Dawg Entertainment label-head Anthony "Top Dawg" Tiffith, Sounwave, DJ Dahi, Mike Will Made It and Ricci Riera, as well as production contributions from James Blake, Steve Lacy BadBadNotGood, Greg Kurstin, The Alchemist, 9th Wonder, and others.</p>
    <p class="right-column-prose">Damn (stylized as DAMN.) is the fourth studio album by American rapper Kendrick Lamar.[1] It was released on April 14, 2017, by Top Dawg Entertainment, Aftermath Entertainment and Interscope Records.[2] The album features production from a variety of record producers, including executive producer and Top Dawg Entertainment label-head Anthony "Top Dawg" Tiffith, Sounwave, DJ Dahi, Mike Will Made It and Ricci Riera, as well as production contributions from James Blake, Steve Lacy BadBadNotGood, Greg Kurstin, The Alchemist, 9th Wonder, and others.</p>
    <p class="right-column-prose">Damn (stylized as DAMN.) is the fourth studio album by American rapper Kendrick Lamar.[1] It was released on April 14, 2017, by Top Dawg Entertainment, Aftermath Entertainment and Interscope Records.[2] The album features production from a variety of record producers, including executive producer and Top Dawg Entertainment label-head Anthony "Top Dawg" Tiffith, Sounwave, DJ Dahi, Mike Will Made It and Ricci Riera, as well as production contributions from James Blake, Steve Lacy BadBadNotGood, Greg Kurstin, The Alchemist, 9th Wonder, and others.</p>
    <p class="right-column-prose">Damn (stylized as DAMN.) is the fourth studio album by American rapper Kendrick Lamar.[1] It was released on April 14, 2017, by Top Dawg Entertainment, Aftermath Entertainment and Interscope Records.[2] The album features production from a variety of record producers, including executive producer and Top Dawg Entertainment label-head Anthony "Top Dawg" Tiffith, Sounwave, DJ Dahi, Mike Will Made It and Ricci Riera, as well as production contributions from James Blake, Steve Lacy BadBadNotGood, Greg Kurstin, The Alchemist, 9th Wonder, and others.</p>
    <p class="right-column-prose">Damn (stylized as DAMN.) is the fourth studio album by American rapper Kendrick Lamar.[1] It was released on April 14, 2017, by Top Dawg Entertainment, Aftermath Entertainment and Interscope Records.[2] The album features production from a variety of record producers, including executive producer and Top Dawg Entertainment label-head Anthony "Top Dawg" Tiffith, Sounwave, DJ Dahi, Mike Will Made It and Ricci Riera, as well as production contributions from James Blake, Steve Lacy BadBadNotGood, Greg Kurstin, The Alchemist, 9th Wonder, and others.</p>
    <p class="right-column-prose">Damn (stylized as DAMN.) is the fourth studio album by American rapper Kendrick Lamar.[1] It was released on April 14, 2017, by Top Dawg Entertainment, Aftermath Entertainment and Interscope Records.[2] The album features production from a variety of record producers, including executive producer and Top Dawg Entertainment label-head Anthony "Top Dawg" Tiffith, Sounwave, DJ Dahi, Mike Will Made It and Ricci Riera, as well as production contributions from James Blake, Steve Lacy BadBadNotGood, Greg Kurstin, The Alchemist, 9th Wonder, and others.</p>
    <p class="right-column-prose">Damn (stylized as DAMN.) is the fourth studio album by American rapper Kendrick Lamar.[1] It was released on April 14, 2017, by Top Dawg Entertainment, Aftermath Entertainment and Interscope Records.[2] The album features production from a variety of record producers, including executive producer and Top Dawg Entertainment label-head Anthony "Top Dawg" Tiffith, Sounwave, DJ Dahi, Mike Will Made It and Ricci Riera, as well as production contributions from James Blake, Steve Lacy BadBadNotGood, Greg Kurstin, The Alchemist, 9th Wonder, and others.</p>
  </div>
</div>



<script src="https://d3js.org/d3.v4.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.5/ScrollMagic.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.5/plugins/debug.addIndicators.min.js"> </script>
<script>

    //initilize scrollmagic
    var controller = new ScrollMagic.Controller();


    //////////////////////////////////////////////////////////////////////
    /////////////////////////  GLOBAL VARIABLES  /////////////////////////
    //////////////////////////////////////////////////////////////////////

    // App holder for keeping global scope clean
    DS = {}

    // set the dimensions and margins of the graph
    var margin = {top: 20, right: 20, bottom: 30, left: 50},
      width = 930 - margin.left - margin.right,
      height = 460 - margin.top - margin.bottom;

    // parse the date / time
    var parseTime = d3.timeParse("%y%m");
    var parseYear = d3.timeFormat("%Y"),
      parseMonth = d3.timeFormat("%b");
    var parseTimeMonth = d3.timeParse("%b");
    var parseMonthOnly = d3.timeParse("%m")


    // set the ranges
    var x = d3.scaleTime().domain([parseTimeMonth("jan"),parseTimeMonth("dec")]).range([0, width]);
    var y = d3.scaleLinear().range([height, 0]);


    // define the line
    var valueLine = d3.line()
        .x(function(d) { return x(parseTimeMonth(d.month)); })
        .y(function(d) { return y(+d.Births); })
        ;

    // define the line
    var valueLineState = d3.line()
        .x(function(d) { return x(parseTimeMonth(d.month)); })
        .y(function(d) { return y(+d.stateBirths); })
        ;

    // define the line
    var valueLineA = d3.line()
        .x(function(d) { return x(parseTimeMonth(d.month)); })
        .y(function(d) { return y(+d.median); })
        ;

    // append the svg object to the body of the page
    // appends a 'group' element to 'svg'
    // moves the 'group' element to the top left margin
    var svg = d3.select("#graph").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("transform",
              "translate(" + margin.left + "," + margin.top + ")")
        .attr("class", "svg");

    //////////////////////////////////////////////////////////////////////
    ////////////////////////////  RESPONSIVE  ////////////////////////////
    //////////////////////////////////////////////////////////////////////

    // make chart responsive
    d3.select("#graph")
        .append("div")
        .classed("svg-container", true) //container class to make it responsive
        .append("svg")

      //responsive SVG needs these 2 attributes and no width and height attr
        .attr("preserveAspectRatio", "xMinYMin meet")
        .attr("viewBox", function(d){
          "0 0 1280 640";
        })

      //class to make it responsive
        .classed("svg-content-responsive", true);




    //////////////////////////////////////////////////////////////////////
    ////////////////////////////  DATA IMPORT ////////////////////////////
    //////////////////////////////////////////////////////////////////////


    // Queue multiple files
    d3.queue()
      .defer(d3.csv, "stateCountyNames.csv")
      .defer(d3.csv, "CondensedBirth3.csv")
      .defer(d3.csv, "stateData.csv")
      .defer(d3.csv, "stateAverages.csv")
      .defer(d3.csv, "stateAveragesNormal.csv")
      .await(ready);



    // Get the data
function ready(error,
    stateCounty,
    data,
    stateData,
    stateAverages,
    stateNormal) {

        if (error) throw error;

        stateCounty.forEach(function(d){
          d.County_Name = d.County_Name
          d.County = +d.County
          d.stateName = d.stateName
        })


        // format the data
        data.forEach(function(d) {
            d.Date = parseTime(d.Date);
            d.month = parseMonth(d.Date);
            d.year = parseYear(d.Date);
            d.Births = +d.Births * 10;
            d.County = d.County;
        });


        // format the state level data
        stateData.forEach(function(d){
          d.Date = parseTime(d.Date);
          d.month = parseMonth(d.Date);
          d.year = parseYear(d.Date);
          d.stateBirths = +d.stateBirths;
          d.states = d.states;
          d.dayAvg = +d.dayAvg;
        })

        // format state average data
        stateAverages.forEach(function(d){
          d.states = d.states;
          d.month = parseMonth(parseMonthOnly(d.M));
          d.median = +d.median;
          d.low = +d.low;
          d.high = +d.high;
          d.values = +d.median;
        })

        stateNormal.forEach(function(d){
          d.states = d.states;
          d.month = parseMonth(parseMonthOnly(d.M));
          d.median = +d.median;
          d.low = +d.low;
          d.high = +d.high;
          d.values = +d.median;
          d.dayAvg = +d.dayAvg;
        })



        //////////////////////////////////////////////////////////////////////
        //////////////////////////// NESTING DATA ////////////////////////////
        //////////////////////////////////////////////////////////////////////


        ///////////////////////////  NEST COUNTIES  //////////////////////////

        // Nest the data to create a line for each county and each year
        var nested = d3.nest()
            .key(function(d) { return d.County; })
            .rollup(function(leaves){
              var extent = d3.extent(leaves, function(d){
                return d.Births
              })
              var nest = d3.nest().key(function(d){
                return d.year
              })
              .entries(leaves);
              return {extent:extent, years:nest};
            })
            .entries(data);


        ///////////////////////////  NEST YEARS  //////////////////////////

        // Nest data by year
        var nested2 = d3.nest()
            .key(function(d){ return d.year; })
            .entries(data);

        ///////////////////////////  NEST STATES  //////////////////////////

        var nestedStates = d3.nest()
            .key(function(d){ return d.stateName; })
            .rollup(function(leaves){
              var nest = d3.nest().key(function(d){
                return d.County
              })
              .entries(leaves);
              return { Counties:nest };
            })
            .entries(stateCounty)

        ///////////////////////////  NEST STATES2  //////////////////////////

        // Nest the data to create a line for each county and each year
        var nestMStates = d3.nest()
            .key(function(d) { return d.states; })
            .rollup(function(leaves){
              var extent = d3.extent(leaves, function(d){
                return d.stateBirths
              })
              var nest = d3.nest().key(function(d){
                return d.year
              })
              .entries(leaves);
              return {extent:extent, years:nest};
            })
            .entries(stateData);

            console.log(nestMStates)

        /////////////////////////// NEST STATE AVG  //////////////////////////

        var nestAStates = d3.nest()
          .key(function(d){
            return d.states;
          })
          .entries(stateAverages)

        ///////////////////////////  NEST STATE NORMAL  //////////////////////////

        var nestNStates = d3.nest()
          .key(function(d){
            return d.states;
          })
          .entries(stateNormal)

    //////////////////////////////////////////////////////////////////////
    //////////////////////////  COUNTY NAMES  ////////////////////////////
    //////////////////////////////////////////////////////////////////////

          var countyMap = d3.map(stateCounty, function(d){
            return d.County
          })

          console.log(countyMap)


    //////////////////////////////////////////////////////////////////////
    /////////////////////////  STATE DROPDOWN  //////////////////////////
    //////////////////////////////////////////////////////////////////////

        // Create dropdown 1
        var Slist = d3.select("#states")
        Slist.append("select").selectAll("option")
            .data(nestedStates)
            .enter().append("option")
            .attr("value", function(d){
                return d.key;
            })
            .text(function(d){
                return d.key;
            })

    //////////////////////////////////////////////////////////////////////
    /////////////////////////  COUNTY DROPDOWN  //////////////////////////
    //////////////////////////////////////////////////////////////////////


        // Figure out which state is displayed

        var updateCountyDrop = function(selectCounty){
            var selectedState = Slist.select("select").property("value")

            var selectedStateG = nestedStates.filter(function(d){
                return d.key === selectedState;
            })

            var selectedCounties = selectedStateG.map(function(d){
              return d.value.Counties;
            })

            var selectedCounties2 = selectedCounties[0].map(function(d){
              return d.key;
            })

            console.log(selectedCounties2)

            var Clist = d3.select("#counties")
                .append("select").selectAll("option")
                .data(selectedCounties2)
                .enter().append("option")
                .attr("value", function(d){
                  return countyMap.get(d).County;
                })
                .text(function(d){
                  return countyMap.get(d).County_Name;
                })
                .property("selected", function(d){
                return +d === selectCounty; })

            Clist.exit().remove();
        }



    //////////////////////////////////////////////////////////////////////
    ///////////////////// MULTI LINE COUNTY FUNCTION /////////////////////
    //////////////////////////////////////////////////////////////////////

        var multiCounty = function(data, countyCode, year){

            var county = data.filter(function(d){
              return +d.key == +countyCode;
            })

            var pickedCounty = svg.selectAll("g")
                    .data(county, function(d){
                      return d ? d.key : this.key;
                    })
                    .enter()
                    .append("g")
                    .attr("class", "counties")
                    .each(function(d){
                      y.domain(d.value.extent)
                    })
                    .selectAll("path")
                    .data(function(d) {
                      return (d.value.years);
                    })
                    .enter()
                    .append("path")
                    .attr("d",function(d){
                      return valueLine(d.values);
                    })
                    .attr("class", "line");

              var initialLine = svg.selectAll(".line")
                  .filter(function(d){
                    return +d.key === +year;
                  })
                  .classed("selected", true)

              // Reset the State dropdown based on the state of selected county
              var stateDrop = Slist.selectAll("option")
                .property("selected", function(d){
                return d.key === countyMap.get(county[0].key).stateName;
              })

              // Print which state has been selected (for updating county dropdown)
              selectedState = Slist.select("select").property("value")

              // Print which county has been selected (for updating county dropdown)
              selectedCounty = countyMap.get(county[0].key).County;


              // Update county dropdown
              updateCountyDrop(selectedCounty);

          };

          ///////////////////////////  CALL TO INITIAL GRAPH  //////////////////////////

          // Call function to create initial figure
          // currently set to LA County
          multiCounty(nested, 6037, 2015);


    //////////////////////////////////////////////////////////////////////
    //////////////////////////////  AXES  ////////////////////////////////
    //////////////////////////////////////////////////////////////////////

          var xaxis = svg.append("g")
                 .attr("transform", "translate(0," + height + ")")
                 .attr("class", "x axis")
                 .call(d3.axisBottom(x)
                    .ticks(d3.timeMonth)
                    .tickSize(0, 0)
                    .tickFormat(d3.timeFormat("%b"))
                    .tickSizeInner(0)
                    .tickPadding(10));

            // Add the Y Axis
             var yaxis = svg.append("g")
                 .attr("class", "y axis")
                 .call(d3.axisLeft(y)
                    .ticks(5)
                    .tickSizeInner(0)
                    .tickPadding(6)
                    .tickSize(0, 0));



    ///////////////////////////  STATE CHANGE  //////////////////////////

    // Need to update available counties

        Slist.on('change', function(){
          var selectedState = d3.select(this)
              .select("select")
              .property("value")

          selectedStateG = nestedStates.filter(function(d){
            return d.key === selectedState;
          })

          console.log(selectedStateG)

    //////////////////////////////////////////////////////////////////////
    /////////////////////////  COUNTY DROPDOWN  //////////////////////////
    //////////////////////////////////////////////////////////////////////



        //d3.selectAll(".county-dd").remove()



        var selectedCounties = selectedStateG.map(function(d){
          return d.value.Counties;
        });

        var selectedCounties2 = selectedCounties[0].map(function(d){
          return d.key;
        })


        // Create dropdown 1
        var list = d3.select("#counties2")
            //.append("select").selectAll("option")
            //.data(selectedCounties2);

        var selection = list.selectAll("select");
            if (selection.empty()) {
              selection = list.append("select");
            }



        selection = selection.selectAll("option")
              .data(selectedCounties2, function(d){
                return d;
              });


          // exit selection
          selection.exit().remove();

          console.log(selection)

          // enter selection
          selection.enter().append("option")
              .attr("value", function(d){
                  return countyMap.get(d).County;
              })
              .text(function(d){
                  return countyMap.get(d).County_Name;
              })






    ///////////////////////////  COUNTY CHANGE  //////////////////////////

        // Create line based on selection from dropdown 1
        list.on('click', function(){


            ////////////  DETECTING SELECTED YEAR  ///////////

            // Detecting whether a single year has already been selected
            var blueLine = d3.selectAll(".selected")
                //.data()
                if(blueLine.empty()){
                  blueLine[0].key == 2015
                }


            var blueLineY = blueLine[0].key
            svg.selectAll(".line2").remove()
            svg.selectAll(".area").remove()


            ////////////  DATA JOIN FOR COUNTIES  ///////////

            // Determine which county was selected from dropdown
            var selected = d3.select(this)
                .select("select")
                .property("value")



            // Filter data to only include selected county
            var selectCounty = nested.filter(function(d){
              return +d.key === +selected;
            });


            // Group the county-level data
           var Counties = svg.selectAll(".counties")
                .data(selectCounty, function(d){
                  return d ? d.key : this.key;
                });


            // Remove any lines that don't carry over between counties
            Counties.exit().remove();


            // Add grouping element
            var CountiesEnter = Counties.enter()
                .append("g")
                .attr("class", "counties")
                .each(function(d){
                  y.domain(d.value.extent)
                });

console.log(CountiesEnter)
            // Select all the paths
            var Paths = CountiesEnter.selectAll("path")
                .data(function(d) {
                  return (d.value.years);
                })

                console.log(Paths)
            // Enter and append any new paths
            var PathsEnter = Paths.enter()
                .append("path")
                .attr("class", "line")
                .transition()
                    .duration(5000)
                    .attr("d",function(d){
                        return valueLine(d.values);
                    });

                    console.log(PathsEnter)

            // If a line was already selected when the county was changed
            // Make sure that same year's line is still selected
            var selLineU = svg.selectAll(".line")
                .filter(function(d) {
                  return +d.key === +blueLineY
                })
                .classed("selected", true)

             Counties = CountiesEnter
                .merge(Counties);


              ////////////  UPDATE Y AXIS  ///////////

              /* X axis could be updated the same way but the
              x axis doesn't change in this figure*/

              // Update Y Axis
              d3.select(".y")
                .transition()
                .duration(750)
                .call(d3.axisLeft(y)
                    .ticks(5)
                    .tickSizeInner(0)
                    .tickPadding(6)
                    .tickSize(0, 0));
        });

      });


    //////////////////////////////////////////////////////////////////////
    //////////////////////////  YEAR DROPDOWN  ///////////////////////////
    //////////////////////////////////////////////////////////////////////

        // Create dropdown 2 (year)
        var yList = d3.select("#year")
        yList.append("select").selectAll("option")
            .data(nested2)
            .enter().append("option")
            .attr("value", function(d){
              return d.key;
            })
            .text(function(d){
              return d.key;
            })
            .property("selected", function(d){ return d.key === "2015"; })


    ///////////////////////////  YEAR CHANGE  //////////////////////////

        // Select year from dropdown
        yList.on('change', function(){
          var selectedYear = d3.select(this)
              .select("select")
              .property("value")


          // select all paths and select one that the year matches
          var selLine = svg.selectAll(".line")
            // de-select all the lines
            .classed("selected", false)
            .filter(function(d) {
                return +d.key === +selectedYear
            })
            // Set class to selected for matching line
            .classed("selected", true)
        })

    //////////////////////////////////////////////////////////////////////
    /////////////////////////  EVENT DROPDOWNS  //////////////////////////
    //////////////////////////////////////////////////////////////////////



        // Create dropdown  (Event: Storms)
        var stormsList = d3.select("#icon-dropdown")
          stormsList.append("select").selectAll("option")
            .data(nestAStates)
            .enter().append("option")
            .attr("value", function(d){
              return d.key;
            })
            .text(function(d){
              return d.key;
            })


    ///////////////////////////  STORM CHANGE  //////////////////////////

        // Select year from dropdown
        stormsList.on('change', function(){

          // Quickly remove any previously drawn lines
          svg.selectAll(".line").remove();
          svg.selectAll(".line2").remove();



        ////////////  DATA JOIN FOR MEDIAN  ///////////
            // Determine which county was selected from dropdown
            var avStateSel = d3.select(this)
                .select("select")
                .property("value")

            // Filter data to only include selected county
            var selectAvState = nestAStates.filter(function(d){
              return d.key === avStateSel;
            });

            console.log(selectAvState)
            // Group the county-level data
           var avStates = svg.selectAll(".avStates")
                .data(selectAvState, function(d){
                  return d ? d.key : this.key;
                });


            // Remove any lines that don't carry over between counties
            avStates.exit().remove();

            y.domain([d3.min(selectAvState[0].values, function(d) {return +d.low}), d3.max(selectAvState[0].values, function(d){ return +d.high})]);

            ////////////  DATA JOIN FOR AREA  ///////////

              var areaFill = d3.area()
                // Same x axis (could use .x0 and .x1 to set different ones)
                .x(function(d) { return x(parseTimeMonth(d.month)); })
                .y0(function(d, i) { return y(+d.low); })
                .y1(function(d, i) { return y(+d.high); })
                .curve(d3.curveBasis);

                console.log(areaFill)

                svg.selectAll(".area").remove();

              var areaEnter = avStates.enter().append("path")
                //.datum(selectAvState)
                .attr("d", function(d){
                  return areaFill(d.values); })
                .attr("fill", "#B2C1E3")
                .attr("opacity", 0.8)
                .attr("class", "area");



                console.log(areaEnter)

              // Add Median Line (later so on top of area)
              var statePathsEnter = avStates.enter()
                .append("path")
                .attr("class", "line2")
                .attr("d", function(d){
                  return valueLineA(d.values);
                })





              ////////////  UPDATE Y AXIS  ///////////

              /* X axis could be updated the same way but the
              x axis doesn't change in this figure*/

              // Update Y Axis
              d3.select(".y")
                .transition()
                .duration(750)
                .call(d3.axisLeft(y)
                    .ticks(5)
                    .tickSizeInner(0)
                    .tickPadding(6)
                    .tickSize(0, 0));
        //});
        });


    //////////////////////////////////////////////////////////////////////
    //////////////////////  NORMALIZED DROPDOWNS  ////////////////////////
    //////////////////////////////////////////////////////////////////////



        // Create dropdown  (Event: Storms)
        var normalList = d3.select("#icon-dropdown2")
          normalList.append("select").selectAll("option")
            .data(nestNStates)
            .enter().append("option")
            .attr("value", function(d){
              return d.key;
            })
            .text(function(d){
              return d.key;
            })
            /*.property("selected", function(d){
              return d.key === "2015";
            })*/



    ///////////////////////////  STORM CHANGE  //////////////////////////

        // Select year from dropdown
        normalList.on('change', function(){

          // Quickly remove any previously drawn lines
          svg.selectAll(".line").remove();
          svg.selectAll(".line2").remove();



        ////////////  DATA JOIN FOR MEDIAN  ///////////
            // Determine which county was selected from dropdown
            var nStateSel = d3.select(this)
                .select("select")
                .property("value")

            // Filter data to only include selected county
            var selectNState = nestNStates.filter(function(d){
              return d.key === nStateSel;
            });

            // Group the county-level data
           var nStates = svg.selectAll(".nStates")
                .data(selectNState, function(d){
                  return d ? d.key : this.key;
                });

                console.log(nStates)

            // Remove any lines that don't carry over between counties
            nStates.exit().remove();

            y.domain([d3.min(selectNState[0].values, function(d) {return +d.low}), d3.max(selectNState[0].values, function(d){ return +d.high})]);

            ////////////  DATA JOIN FOR AREA  ///////////

              var areaFill = d3.area()
                // Same x axis (could use .x0 and .x1 to set different ones)
                .x(function(d) { return x(parseTimeMonth(d.month)); })
                .y0(function(d, i) { return y(+d.low); })
                .y1(function(d, i) { return y(+d.high); })
                .curve(d3.curveBasis);

                svg.selectAll(".area").remove();

              var areaEnter = nStates.enter().append("path")
                //.datum(selectAvState)
                .attr("d", function(d){
                  return areaFill(d.values); })
                .attr("fill", "#B2C1E3")
                .attr("opacity", 0.8)
                .attr("class", "area");


              // Add Median Line (later so on top of area)
              var stateNPathsEnter = nStates.enter()
                .append("path")
                .attr("class", "line2")
                .attr("d", function(d){
                  return valueLineA(d.values);
                })




              ////////////  UPDATE Y AXIS  ///////////

              /* X axis could be updated the same way but the
              x axis doesn't change in this figure*/

              // Update Y Axis
              d3.select(".y")
                .transition()
                .duration(750)
                .call(d3.axisLeft(y)
                    .ticks(5)
                    .tickSizeInner(0)
                    .tickPadding(6)
                    .tickSize(0, 0));
        //});
        });


        var pinBubbleChart = new ScrollMagic.Scene({
      				// triggerElement: ".third-chart-wrapper",
      				triggerElement: "#container",
      				triggerHook:0,
      				offset: -100,
      				duration:600
      			})
      			.addIndicators({name: "pin chart"}) // add indicators (requires plugin)
      			.setPin("#graph", {pushFollowers: true})
      			.addTo(controller)
      			.on("enter",function(e){
      				if(e.target.controller().info("scrollDirection") == "REVERSE"){
      				};
      			})
      			.on("leave",function(e){
      				if(e.target.controller().info("scrollDirection") == "FORWARD"){
      				};
      			})
      			.on("progress", function (e) {
      				var progress = e.progress.toFixed(1);
      				if(e.target.controller().info("scrollDirection") == "REVERSE"){
      				}
      				else{
      				}
      			})
      			;



        var firstTrigger = new ScrollMagic.Scene({
            // triggerElement: ".third-chart-wrapper",
            triggerElement: "#right-column",
            triggerHook:0,
            offset: 0,
            duration:400
          })
          .addIndicators({name: "first trigger"}) // add indicators (requires plugin)
          .addTo(controller)
          .on("enter",function(e){
            if(e.target.controller().info("scrollDirection") == "REVERSE"){
            }
            else{
              console.log("entering from the front!");

            }
          })
          .on("leave",function(e){
            if(e.target.controller().info("scrollDirection") == "REVERSE"){
              console.log("leaving from the back!");
            }
            else{
            }
          })
          ;


    };
</script>
</body>
</html>
